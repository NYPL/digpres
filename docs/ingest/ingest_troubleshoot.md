---
layout: page
title: Ingest Issues Troubleshooting
parent: Ingest
nav_order: 10
---

# Ingest Issues Troubleshooting

{: .no_toc }
&nbsp;
{: .no_toc .text-delta }

1. TOC
{:toc}

Ingesting content into Preservica encounters issues from time to time.
Digital Preservation program uses below methods to understand the cause and
resolve them.

## How are issues spotted?

There are a couple of ways that we check if the ingest process encounters any blockage.

### Exception log file

"Exception log" is a plaintext file generated by the ingest script,
and it lists the file(s) that are not included in the package staged for ingest.
This is the first file to check, in case there are files not included in the package.

### Workflow status on the Preservica website ingest monitor

After logging into Preservica, click Ingest > Monitor, and the screen will
show all the processes. A workflow status indicates whether the ingest was successful.

If the ingest workflow completed successfully, there will be a green check mark for the
package. If the workflow has issue(s), there will be an orange check mark.
On the same page, there is a section that lists all the messages, "Info", "Warning",
"Error". Successful workflows can sometimes include "warning" and "error" messages for
some issues, such as filename encoding errors.

To further check the details of ingest status, follow below steps:

1. log into [Preservica website](https://nypl.preservica.com/)
2. click Ingest > Completed
3. Set up the Filter to show workflows created by "All Users",
   date range you check for and check "All Workflow Instances"
4. if any workflow is in orange or red texts, they need to be reviewed
5. to review what step went wrong, click into the "Workflow Context" field
6. check if any "State" field does not have a green check mark
7. click into "List all child workflows" to see if there is any workflow
   context that has issues, which would be in red texts
8. click into the "Workflow Context" for the child workflow that has red texts,
   and the "Step Progress" table will show us what step was blocking the
   ingest progress, such as "Virus Check"

How we navigate what the actual causes are will be introduced in the next section.

## Specific issues and how we resolve them

### Files with unexpected extensions or incorrect file naming conventions

For files listed in the "Exception log", we review them individually. These exceptions
are defined in the ingest script. Specifically, they catch files with unexpected
extensions and incorrect file naming conventions.

#### Example 1

Our program expects the Born Digital Archives metadata file to
be a comma-separated values or tab-separated values file, which has .CSV and .TSV
extensions respectively.

In some instances, we found metadata files that are plaintext files, with the .TXT
extension. In this case, our program reviews the files individually with Digital
Archives program and decides what the solution should be. The most common reason of
having a plaintext metadata file results from incorrect selection of the export file
type when the archivist exports the metadata file.

> In this context, the content of the file is the same. Therefore, our program
> migrates the data from plaintext format to the .CSV format.

#### Example 2

Our program expects specific naming conventions for some folders and files. For Born
Digital Archives, the package folder name should confirm to the regular expression,
`M[0-9]+_(ER|DI|EM)_[0-9]+`, where `ER` means Electronic Records; `DI` means Disk
Images; and `EM` means Email. A valid example is `M1126_ER_1`

In one collection, we found packages named as `M1234_ER1`, `M1234_ER2`, etc. When
similar cases show up, our program also reviews these packages with the Digital
Archives program to decide what the solution should be.

> This issue usually comes from human errors, where other structures are correct,
> and only the folder names need to be updated. Therefore, after the review process
> with Digital Archives staff, we update the folder names to `M1234_ER_1` and
> `M1234_ER_2`.

For unsuccessful ingest workflows, they can result from various reasons. Preservica is
format-agnostic, meaning it does not restrict ingested content by its file format.
It also does not read into file content much, except for generating checksum and
virus check. However, Preservica reads filenames and uses them to create assets metadata.
Therefore, when there are unsuccessful ingest processes, they usually result from issues
of the filename or during the virus checking step.

### Filename encoding issues

For filename encoding issues, we use the command line software,
xxd, to investigate any hidden characters in the filename. For instance, to see the filename's
hex value of a file called, "digital_preservation.docx", we can use this command
in the terminal:

  ```sh
    ls -1 path/to/file | xxd
  ```

This command prints out the hex data of the file path. Hex is short for hexadecimal. Hexadecimal
data represents binary data using the base 16 number system, and it allows us to see the filename
in a more granular level, including hidden characters.
In two collections, our program discovered files with hidden characters, `\x7f`, in their filenames.
After some research, we found out `\x7f` means `DEL`, delete in ASCII characters.

### Filename having characters unaccepted by Preservica

in some cases, filenames have characters that
Preservica does not accept. This is because Preservica uses XML to store and transact metadata, and
XML does not accept some characters, including `&`, `<`, `>`, `"`, `'`.

#### Example 1

In our ingest process, we encounter filenames that have `&` very often.

> solution to be added.

### Virus detected in the file

Preservica scans for computer virus with ClamAV, an open source antivirus
software, before ingesting the package. Therefore, if there is any virus detected in one or more
files in one package, the package will not be ingested, and the ingest workflow will be halted.

After the workflow is halted, our program will do research on the specific computer
virus to understand its effects on modern computer environments and assess the risks.
Our program will make decisions on whether to ingest the files, depending on the research.
In some cases, if the impacts of the computer virus do not extend to the modern computers
and software, our program would ingest the file into the repository. If the risks still
exist, our program would remove the infested file from the package before the ingest.

#### Example 1

In one collection, we found a Windows Trojan virus named "Win.Trojan.Cap-1" in
ClamAV's virus registry. After some research using the Internet Archive,
we found that this computer virus, "CAP", was most likely a Microsoft Word Macro virus.
[This Microsoft Security Intelligence page](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?name=Virus%3AWM%2FCap.A),
[this Internet Archive capture](https://web.archive.org/web/20130729073004/http://vxheaven.org/29a/29a-2/29a-2.5_6)
, [the Virus Encyclopedia](http://virus.wikidot.com/cap) and [F-Secure](https://www.f-secure.com/v-descs/cap.shtml)
give us information most relevant to this virus.

A macro, in computer programming, is a rule, pattern, or sequence of events
that allows users to automate repetitive tasks. In the context of Microsoft Office
Suites, the user can create macros to record a set of actions that they want to
run as many times as they'd like.

A macro virus is written in the same language as the macro of the software.
In the CAP virus' context, it was written in Visual Basic for Applications.
And it impacts ten macros in Microsoft Word, as documented in
[the Virus Encyclopedia](http://virus.wikidot.com/cap), including FileOpen,
AutoClose, FileSave, FileSaveAs, and so on.

Quoting from the Virus Encyclopedia of the behavior of this virus:
> When an infected file is opened,
> CAP removes the macros in NORMAL.DOT and replaces them with its own.
> It removes the options of Macros and Customize under the Tools drop menu,
> as well as Templates under file. If there is an icon on the toolbar,
> it will still be there, but it will not function.
> When the macros are decrypted, the following text can be seen:
> 'C.A.P: Un virus social.. y ahora digital..
> '"j4cKy Qw3rTy" (jqw3rty@hotmail.com).
> 'Venezuela, Maracay, Dic 1996.
> 'P.D. Que haces gochito ? Nunca seras Simon Bolivar.. Bolsa !
> This translates into: "'C.A.P: A social virus, and now a digital one.
> (The next two lines are about the creator and the time and location of the virus's
> creation.) PS, What are you doing little cowboy? You will never be Simon Bolivar! Stupid!
